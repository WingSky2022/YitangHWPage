# Markdown 格式渲染规则

## 1. 列表操作规则

### 1.1 列表回退 (Backspace Behavior)

*   **场景**: 当光标位于有序列表或无序列表项的起始位置（第一个字符前）时。
*   **操作**: 按下 `Backspace` (退格键)。
*   **预期行为**:
    *   取消当前行的列表状态，将其转换为普通段落。
    *   当前行内容保留。
    *   **不会**与上一行内容发生合并。
    *   **不会**删除上一行的换行符。

### 1.2 列表触发 (Triggering)

*   **有序列表**: 输入 `1. ` (数字+点+空格) 自动转换为有序列表。
*   **无序列表**: 输入 `* ` 或 `- ` (星号/减号+空格) 自动转换为无序列表。
*   **引用**: 输入 `> ` (大于号+空格) 自动转换为引用块。

## 2. 视觉规范

*   **行高 (Line Height)**: `1.6`
*   **列表项底部间距**: `0.2em`
*   **H3 标题上边距**: `0.5em` (字号 18px)

## 3. 格式隔离与解耦规则 (Formatting Isolation)

为了防止 Markdown 渲染时的“跳行”或块级污染问题，必须遵循以下规则：

1.  **单行独立原则**：任何 Markdown 块级触发器（标题、列表、引用）在生效时，必须确保其所在行已经是一个独立的 DOM 块，不允许与非目标行的内容共用同一个 `<p>` 或 `<div>` 容器（即禁止使用 `<br>` 进行行内换行分隔）。
2.  **强制替换逻辑**：渲染器应优先使用 `DOM.replaceChild` 手动构建目标元素，而非依赖 `execCommand` 的自动转换，以防止浏览器原生逻辑错误地合并相邻的不相关块。
3.  **列表首行去依赖**：手动创建列表的首个 `<li>` 标签，确保其上下文与上一行完全切断，从而解决“删除后再次输入导致跳行”的 Bug。

### 3.4 引用块 (Blockquote)

*   **视觉样式**:
    *   **Border Color**: `#60a5fa` (Blue-400).
    *   **Font Style**: `normal` (非斜体).
    *   **Text Color**: `#6b7280` (Gray-500).
    *   **Padding**: `padding-left: 1em`.
*   **合并规则 (Merging)**:
    *   相邻的引用块 (`blockquote + blockquote`) 将自动通过负边距抵消垂直间距，在视觉上呈现为连接状态。
    *   实现方式：CSS `margin-top: -{blockquoteMargin}`。
*   **回退行为 (Backspace)**:
    *   光标保持在当前行，**不**会与上一行合并。

### 3.5 引用块回车行为 (Enter in Blockquote)

*   **场景**: 在引用块内按下 `Enter` 键。
*   **规则**:
    *   若当前行内容不为空：正常换行，新行保持引用格式。
    *   若当前行内容为空 (或仅包含空字符)：**跳出引用块**，将当前行转换为普通段落 (`<p>`)，光标移至该新段落。

## 4. 工具栏交互规则 (Toolbar Interaction)

*   **标题按钮 (H1/H2/H3)**:
    *   **智能切换**: 若当前行已是对应标题格式，再次点击该标题按钮，将回退为普通段落 (`<p>`)。
*   **行内样式按钮 (B/I/Highlight)**:
    *   **状态显示**: 仅当用户**选中了文本**（Selection not collapsed）且该文本包含对应样式时，按钮才显示高亮（黄色）状态。
    *   若光标仅仅是放在已应用样式的文本中间但未进行选择，按钮**不**显示高亮。
*   **全屏模式**:
    *   进入全屏时，应覆盖当前作业题目的完整容器（包含题目标题、题目描述、编辑器主体），而隐藏页面顶部的通用 Header、侧边栏或其他作业题目。
